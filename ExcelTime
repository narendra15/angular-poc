import { DateTime } from 'luxon';

function formatDateToYYYYMMDD(dateInput: Date | string | number): string {
  console.log('formatDateToYYYYMMDD', dateInput);

  // Convert any input to DateTime in EST
  let dt: DateTime;

  if (dateInput instanceof Date) {
    // Excel gives JS Date objects, so interpret as system time, then shift to EST
    dt = DateTime.fromJSDate(dateInput, { zone: 'America/Toronto' });
  } else if (typeof dateInput === 'string' || typeof dateInput === 'number') {
    // For string like "2025-07-31" or serial numbers
    dt = DateTime.fromISO(String(dateInput), { zone: 'America/Toronto' });
  } else {
    throw new Error('Invalid date input');
  }

  // Normalize to midnight in EST
  const normalized = dt.startOf('day').setZone('America/Toronto');

  // Return in YYYY-MM-DD format
  return normalized.toFormat('yyyy-MM-dd');
}







import { DateTime } from 'luxon';

function formatDateToYYYYMMDD(dateInput: Date): string {
  console.log('formatDateToYYYYMMDD', dateInput);

  // Step 1: Convert the JS Date into Luxon's DateTime object
  // Interpret it in the 'America/Toronto' (EST/EDT) timezone
  const dt = DateTime.fromJSDate(dateInput, { zone: 'America/Toronto' });

  // Step 2: Normalize to midnight in EST to eliminate time drift
  const normalized = dt.startOf('day').setZone('America/Toronto');

  // Step 3: Format it into plain YYYY-MM-DD for consistent output
  return normalized.toFormat('yyyy-MM-dd');
}o












import { DateTime } from 'luxon';

const TARGET_ZONE = 'America/Toronto';  // your app’s fixed zone (EST/EDT)

export function formatDateToYYYYMMDD(dateInput: Date): string {
  // 1) Source zone = uploader’s browser zone
  const SOURCE_ZONE = Intl.DateTimeFormat().resolvedOptions().timeZone;

  // 2) Recover uploader’s calendar date from the instant
  const seenByUploader = DateTime.fromJSDate(dateInput).setZone(SOURCE_ZONE);

  // 3) Rebuild that Y-M-D as EST/EDT midnight
  const normalized = DateTime.fromObject(
    { year: seenByUploader.year, month: seenByUploader.month, day: seenByUploader.day },
    { zone: TARGET_ZONE }
  ).startOf('day');

  // 4) Return YYYY-MM-DD
  return normalized.toFormat('yyyy-MM-dd');
}











import { DateTime } from 'luxon';

const TARGET_ZONE = 'America/Toronto'; // EST/EDT

export function formatDateToYYYYMMDD(dateInput: Date | string): string {
  // 1) Parse while preserving the zone from the string (or JS Date’s instant)
  let dt = (typeof dateInput === 'string')
    ? DateTime.fromISO(dateInput, { setZone: true })       // keeps +05:30, etc.
    : DateTime.fromJSDate(dateInput);                      // uses local system zone

  // 2) If SheetJS gave times near midnight (e.g., 23:59), nudge forward to snap to the intended day
  //    (You can widen this window if your files show 23:58~00:02 variations.)
  if (dt.hour === 23 && dt.minute >= 55) {
    dt = dt.plus({ minutes: 10 }); // 23:59 -> next day 00:09
  }

  // 3) Take the calendar parts from that local view
  const y = dt.year, m = dt.month, d = dt.day;

  // 4) Rebuild the SAME Y-M-D at midnight in EST/EDT and format
  const est = DateTime.fromObject({ year: y, month: m, day: d }, { zone: TARGET_ZONE })
    .startOf('day');

  return est.toFormat('yyyy-MM-dd');
}
